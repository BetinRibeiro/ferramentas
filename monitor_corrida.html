<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RunTracker - Monitoramento de Corridas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .tooltip {
            position: absolute;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            font-size: 14px;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-bold text-indigo-700 mb-2">RunTracker</h1>
            <p class="text-gray-600">Monitore seu desempenho nas corridas e veja sua evolução</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Formulário de cadastro -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Cadastrar Corrida</h2>
                <form id="runForm" class="space-y-4">
                    <div>
                        <label for="runDate" class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                        <input type="date" id="runDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div>
                        <label for="distance" class="block text-sm font-medium text-gray-700 mb-1">Distância (km)</label>
                        <input type="number" step="0.01" id="distance" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: 5.2" required>
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700 mb-1">Tempo (minutos)</label>
                        <input type="number" step="0.01" id="time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: 28.5" required>
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
                        <textarea id="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Condições, como você se sentiu..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-200 flex items-center justify-center">
                        <i class="fas fa-plus-circle mr-2"></i> Adicionar Corrida
                    </button>
                </form>
                
                <div class="mt-6 space-y-3">
                    <button id="exportBtn" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-200 flex items-center justify-center">
                        <i class="fas fa-file-export mr-2"></i> Exportar para CSV
                    </button>
                    <div class="relative">
                        <input type="file" id="importFile" accept=".csv" class="hidden">
                        <label for="importFile" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200 flex items-center justify-center cursor-pointer">
                            <i class="fas fa-file-import mr-2"></i> Importar de CSV
                        </label>
                    </div>
                </div>
            </div>

            <!-- Gráficos e estatísticas -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Seu Desempenho</h2>
                        <div class="flex space-x-2">
                            <select id="timeRange" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="7">Últimos 7 dias</option>
                                <option value="30" selected>Últimos 30 dias</option>
                                <option value="90">Últimos 3 meses</option>
                                <option value="365">Último ano</option>
                                <option value="all">Todo período</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <p class="text-sm text-indigo-600 font-medium">Distância Total</p>
                            <p id="totalDistance" class="text-2xl font-bold text-indigo-700">0 km</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-green-600 font-medium">Tempo Médio/km</p>
                            <p id="avgPace" class="text-2xl font-bold text-green-700">0 min/km</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-sm text-purple-600 font-medium">Corridas</p>
                            <p id="totalRuns" class="text-2xl font-bold text-purple-700">0</p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-700 mb-3">Evolução do Pace (min/km)</h3>
                        <div class="chart-container">
                            <canvas id="paceChart"></canvas>
                            <div id="paceTooltip" class="tooltip"></div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">Distância por Corrida</h3>
                        <div class="chart-container">
                            <canvas id="distanceChart"></canvas>
                            <div id="distanceTooltip" class="tooltip"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de corridas -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Histórico de Corridas</h2>
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="Buscar..." class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Distância (km)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tempo (min)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pace (min/km)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Observações</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="runsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Corridas serão inseridas aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div id="noRunsMessage" class="text-center py-8 text-gray-500">
                <i class="fas fa-running text-4xl mb-2 text-gray-300"></i>
                <p>Nenhuma corrida cadastrada ainda. Adicione sua primeira corrida!</p>
            </div>
        </div>
    </div>

    <script>
        // Armazenamento de dados
        let runs = JSON.parse(localStorage.getItem('runs')) || [];
        
        // Elementos do DOM
        const runForm = document.getElementById('runForm');
        const runsTableBody = document.getElementById('runsTableBody');
        const noRunsMessage = document.getElementById('noRunsMessage');
        const exportBtn = document.getElementById('exportBtn');
        const importFile = document.getElementById('importFile');
        const searchInput = document.getElementById('searchInput');
        const timeRange = document.getElementById('timeRange');
        
        // Elementos de estatísticas
        const totalDistanceEl = document.getElementById('totalDistance');
        const avgPaceEl = document.getElementById('avgPace');
        const totalRunsEl = document.getElementById('totalRuns');
        
        // Gráficos
        let paceChart, distanceChart;
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            updateRunsTable();
            updateStats();
            initCharts();
            
            // Definir data padrão como hoje
            document.getElementById('runDate').valueAsDate = new Date();
        });
        
        // Formulário de cadastro
        runForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const runDate = document.getElementById('runDate').value;
            const distance = parseFloat(document.getElementById('distance').value);
            const time = parseFloat(document.getElementById('time').value);
            const notes = document.getElementById('notes').value;
            
            const pace = time / distance;
            
            const newRun = {
                id: Date.now(),
                date: runDate,
                distance,
                time,
                pace,
                notes
            };
            
            runs.push(newRun);
            saveRuns();
            updateRunsTable();
            updateStats();
            updateCharts();
            
            // Resetar formulário
            runForm.reset();
            document.getElementById('runDate').valueAsDate = new Date();
            
            // Animação de confirmação
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Adicionado!';
            submitBtn.classList.remove('bg-indigo-600');
            submitBtn.classList.add('bg-green-500');
            
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-plus-circle mr-2"></i> Adicionar Corrida';
                submitBtn.classList.remove('bg-green-500');
                submitBtn.classList.add('bg-indigo-600');
            }, 2000);
        });
        
        // Exportar para CSV
        exportBtn.addEventListener('click', () => {
            if (runs.length === 0) {
                alert('Nenhuma corrida para exportar!');
                return;
            }
            
            const csvHeader = ['Data', 'Distância (km)', 'Tempo (min)', 'Pace (min/km)', 'Observações'];
            const csvData = runs.map(run => [
                run.date,
                run.distance,
                run.time,
                run.pace.toFixed(2),
                run.notes || ''
            ]);
            
            const csv = [csvHeader, ...csvData].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `RunTracker_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Feedback visual
            exportBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Exportado!';
            exportBtn.classList.remove('bg-green-600');
            exportBtn.classList.add('bg-green-500');
            
            setTimeout(() => {
                exportBtn.innerHTML = '<i class="fas fa-file-export mr-2"></i> Exportar para CSV';
                exportBtn.classList.remove('bg-green-500');
                exportBtn.classList.add('bg-green-600');
            }, 2000);
        });
        
        // Importar de CSV
        importFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            Papa.parse(file, {
                header: true,
                complete: (results) => {
                    const importedRuns = results.data
                        .filter(row => row.Data && row['Distância (km)'] && row['Tempo (min)'])
                        .map(row => {
                            const distance = parseFloat(row['Distância (km)'].replace(',', '.'));
                            const time = parseFloat(row['Tempo (min)'].replace(',', '.'));
                            
                            return {
                                id: Date.now() + Math.floor(Math.random() * 1000),
                                date: row.Data,
                                distance,
                                time,
                                pace: time / distance,
                                notes: row['Observações'] || ''
                            };
                        });
                    
                    if (importedRuns.length > 0) {
                        runs = [...runs, ...importedRuns];
                        saveRuns();
                        updateRunsTable();
                        updateStats();
                        updateCharts();
                        
                        // Feedback visual
                        const importLabel = document.querySelector('label[for="importFile"]');
                        importLabel.innerHTML = '<i class="fas fa-check mr-2"></i> Importado!';
                        importLabel.classList.remove('bg-blue-600');
                        importLabel.classList.add('bg-blue-500');
                        
                        setTimeout(() => {
                            importLabel.innerHTML = '<i class="fas fa-file-import mr-2"></i> Importar de CSV';
                            importLabel.classList.remove('bg-blue-500');
                            importLabel.classList.add('bg-blue-600');
                        }, 2000);
                    } else {
                        alert('Nenhuma corrida válida encontrada no arquivo CSV.');
                    }
                    
                    // Resetar input de arquivo
                    e.target.value = '';
                },
                error: (error) => {
                    alert('Erro ao importar arquivo: ' + error.message);
                    e.target.value = '';
                }
            });
        });
        
        // Busca
        searchInput.addEventListener('input', () => {
            updateRunsTable();
        });
        
        // Filtro de tempo
        timeRange.addEventListener('change', () => {
            updateStats();
            updateCharts();
        });
        
        // Funções auxiliares
        function saveRuns() {
            localStorage.setItem('runs', JSON.stringify(runs));
        }
        
        function updateRunsTable() {
            const searchTerm = searchInput.value.toLowerCase();
            
            const filteredRuns = runs
                .filter(run => 
                    run.date.toLowerCase().includes(searchTerm) ||
                    run.distance.toString().includes(searchTerm) ||
                    run.time.toString().includes(searchTerm) ||
                    (run.notes && run.notes.toLowerCase().includes(searchTerm))
                )
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredRuns.length === 0) {
                runsTableBody.innerHTML = '';
                noRunsMessage.style.display = 'block';
            } else {
                noRunsMessage.style.display = 'none';
                
                runsTableBody.innerHTML = filteredRuns.map(run => `
                    <tr class="fade-in">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(run.date)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${run.distance.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${run.time.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${run.pace.toFixed(2)}</td>
                        <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">${run.notes || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <button onclick="deleteRun(${run.id})" class="text-red-600 hover:text-red-900 mr-2" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        function deleteRun(id) {
            if (confirm('Tem certeza que deseja excluir esta corrida?')) {
                runs = runs.filter(run => run.id !== id);
                saveRuns();
                updateRunsTable();
                updateStats();
                updateCharts();
            }
        }
        
        function updateStats() {
            const days = parseInt(timeRange.value) || 0;
            const now = new Date();
            
            const filteredRuns = runs.filter(run => {
                if (days === 0) return true; // "Todo período"
                
                const runDate = new Date(run.date);
                const diffTime = now - runDate;
                const diffDays = diffTime / (1000 * 60 * 60 * 24);
                return diffDays <= days;
            });
            
            const totalRuns = filteredRuns.length;
            const totalDistance = filteredRuns.reduce((sum, run) => sum + run.distance, 0);
            const avgPace = totalRuns > 0 ? filteredRuns.reduce((sum, run) => sum + run.pace, 0) / totalRuns : 0;
            
            totalRunsEl.textContent = totalRuns;
            totalDistanceEl.textContent = totalDistance.toFixed(2) + ' km';
            avgPaceEl.textContent = avgPace.toFixed(2) + ' min/km';
        }
        
        function initCharts() {
            // Gráfico de pace
            const paceCtx = document.getElementById('paceChart').getContext('2d');
            paceChart = new Chart(paceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Pace (min/km)',
                        data: [],
                        borderColor: 'rgb(99, 102, 241)',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: 'rgb(99, 102, 241)',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: getChartOptions('Pace (min/km)')
            });
            
            // Gráfico de distância
            const distanceCtx = document.getElementById('distanceChart').getContext('2d');
            distanceChart = new Chart(distanceCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Distância (km)',
                        data: [],
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: getChartOptions('Distância (km)')
            });
            
            updateCharts();
        }
        
        function updateCharts() {
            const days = parseInt(timeRange.value) || 0;
            const now = new Date();
            
            let filteredRuns = [...runs];
            
            if (days > 0) {
                filteredRuns = runs.filter(run => {
                    const runDate = new Date(run.date);
                    const diffTime = now - runDate;
                    const diffDays = diffTime / (1000 * 60 * 60 * 24);
                    return diffDays <= days;
                });
            }
            
            // Ordenar por data
            filteredRuns.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Atualizar gráfico de pace
            paceChart.data.labels = filteredRuns.map(run => formatDate(run.date));
            paceChart.data.datasets[0].data = filteredRuns.map(run => run.pace);
            paceChart.update();
            
            // Atualizar gráfico de distância
            distanceChart.data.labels = filteredRuns.map(run => formatDate(run.date));
            distanceChart.data.datasets[0].data = filteredRuns.map(run => run.distance);
            distanceChart.update();
        }
        
        function getChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${title}: ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            };
        }
        
        function formatDate(dateString) {
            return moment(dateString).format('DD/MM/YYYY');
        }
    </script>
</body>
</html>
