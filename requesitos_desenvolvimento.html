<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Requisitos</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: '#183462',
                        primary: '#2D6EE0',
                        accent: '#4CAF50'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #183462;
            min-height: 100vh;
        }
        .tech-gradient {
            background: linear-gradient(135deg, #183462 0%, #2D6EE0 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="text-white font-sans">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8" data-aos="fade-down">
                <h1 class="text-3xl font-bold mb-2">üìã Sistema de Requisitos</h1>
                <p class="text-blue-200">Gerencie seus requisitos de desenvolvimento</p>
            </div>

            <!-- Add Requirement Form -->
            <div class="glass-effect rounded-2xl p-6 mb-6" data-aos="fade-up">
                <form id="requirementForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Novo Requisito</label>
                        <textarea 
                            id="requirementText" 
                            rows="3" 
                            class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200"
                            placeholder="Descreva o requisito..."
                            required
                        ></textarea>
                    </div>
                    <button type="submit" class="w-full bg-primary hover:bg-blue-600 text-white py-3 px-6 rounded-xl font-medium transition duration-200 flex items-center justify-center">
                        <i data-feather="plus" class="mr-2 w-5 h-5"></i>
                        Adicionar Requisito
                    </button>
                </form>
            </div>

            <!-- Import/Export/Clear Section -->
            <div class="glass-effect rounded-2xl p-6 mb-6" data-aos="fade-up">
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Importar CSV</label>
                        <input type="file" id="importFile" accept=".csv" class="hidden">
                        <label for="importFile" class="block w-full bg-primary hover:bg-blue-600 text-white py-3 px-4 rounded-xl text-center cursor-pointer transition duration-200">
                            <i data-feather="upload" class="inline mr-2 w-4 h-4"></i>
                            Importar
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Exportar CSV</label>
                        <button id="exportBtn" class="w-full bg-accent hover:bg-green-600 text-white py-3 px-4 rounded-xl transition duration-200">
                            <i data-feather="download" class="inline mr-2 w-4 h-4"></i>
                            Exportar
                        </button>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Limpar Tudo</label>
                        <button id="clearBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-xl transition duration-200">
                            <i data-feather="trash-2" class="inline mr-2 w-4 h-4"></i>
                            Limpar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Requirements List -->
            <div id="requirementsList" class="space-y-4 mb-8">
                <!-- Requirements will be loaded here -->
            </div>

            <!-- Summary Box -->
            <div class="glass-effect rounded-2xl p-6" data-aos="fade-up">
                <h3 class="text-lg font-semibold mb-4">Resumo dos Requisitos</h3>
                <textarea 
                    id="summaryText" 
                    rows="6" 
                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl mb-4 text-white placeholder-blue-200"
                    readonly
                    placeholder="Seus requisitos aparecer√£o aqui..."
                ></textarea>
                <button id="copyBtn" class="w-full bg-accent hover:bg-green-600 text-white py-3 px-6 rounded-xl font-medium transition duration-200 flex items-center justify-center">
                    <i data-feather="copy" class="mr-2 w-5 h-5"></i>
                    Copiar Todos os Requisitos
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50">
        <div class="glass-effect rounded-2xl p-6 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Editar Requisito</h3>
            <textarea 
                id="editText" 
                rows="4" 
                class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl mb-4 text-white"
            ></textarea>
            <div class="flex space-x-3">
                <button id="saveEditBtn" class="flex-1 bg-primary hover:bg-blue-600 text-white py-2 px-4 rounded-xl transition duration-200">
                    Salvar
                </button>
                <button id="cancelEditBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-xl transition duration-200">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize database
        let db;
        const DB_NAME = 'RequirementsDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'requirements';
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            await initDB();
            await initializeDefaultRequirements();
            await loadRequirements();
        
            feather.replace();
            setupEventListeners();
        });
        
        // Function to clear all requirements
        async function clearAllRequirements() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.clear();
        
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }
        
        // Database functions
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
        
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve();
                };
        
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const store = db.createObjectStore(STORE_NAME, {
                            keyPath: 'id'
                        });
                        store.createIndex('text', 'text', {
                            unique: false
                        });
                    }
                };
            });
        }
        
        async function addOrUpdateRequirement(requirement) {
            return new Promise((resolve, reject) => {
                try {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.put(requirement);
        
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        async function getAllRequirements() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                request.onsuccess = () => {
                    // Sort by createdAt date
                    const sorted = request.result.sort((a, b) =>
                        new Date(a.createdAt) - new Date(b.createdAt)
                    );
                    resolve(sorted);
                };
        
                request.onerror = () => reject(request.error);
            });
        }
        
        async function deleteRequirement(id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.delete(id);
        
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }
        
        // UI functions
        async function loadRequirements() {
            const requirements = await getAllRequirements();
            const list = document.getElementById('requirementsList');
            const summary = document.getElementById('summaryText');
        
            list.innerHTML = '';
            summary.value = '';
        
            requirements.forEach((req, index) => {
                // Add to list
                const requirementElement = document.createElement('div');
                requirementElement.className = 'glass-effect rounded-2xl p-4';
                requirementElement.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="text-white">${req.text}</p>
                                </div>
                                <div class="flex space-x-2 ml-4">
                                    <button class="edit-btn p-2 text-blue-300 hover:text-blue-100" data-id="${req.id}">
                                        <i data-feather="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button class="delete-btn p-2 text-red-300 hover:text-red-100" data-id="${req.id}">
                                        <i data-feather="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                list.appendChild(requirementElement);
        
                // Add to summary
                summary.value += `${index + 1}. ${req.text}\n`;
            });
        
            feather.replace();
        }
        
        function setupEventListeners() {
            // Add requirement
            document.getElementById('requirementForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const text = document.getElementById('requirementText').value.trim();
        
                if (text) {
                    try {
                        const requirement = {
                            id: self.crypto.randomUUID(),
                            text: text,
                            createdAt: new Date().toISOString()
                        };
        
                        await addOrUpdateRequirement(requirement);
                        document.getElementById('requirementForm').reset();
                        await loadRequirements();
                    } catch (error) {
                        console.error('Error adding requirement:', error);
                        alert('Erro ao adicionar requisito. Verifique o console para mais detalhes.');
                    }
                }
            });
        
            // Edit requirement
            document.addEventListener('click', (e) => {
                if (e.target.closest('.edit-btn')) {
                    const id = e.target.closest('.edit-btn').dataset.id;
                    // Get all requirement items
                    const requirementItems = document.querySelectorAll('#requirementsList > div');
        
                    // Find the requirement with matching id
                    let requirementElement = null;
                    for (const item of requirementItems) {
                        const btn = item.querySelector('.edit-btn');
                        if (btn && btn.dataset.id === id) {
                            requirementElement = item;
                            break;
                        }
                    }
        
                    if (requirementElement) {
                        document.getElementById('editText').value = requirementElement.querySelector('p').textContent;
                        document.getElementById('editModal').classList.remove('hidden');
                        document.getElementById('editModal').dataset.editingId = id;
                    }
                }
            });
        
            // Save edit
            document.getElementById('saveEditBtn').addEventListener('click', async () => {
                const id = document.getElementById('editModal').dataset.editingId;
                const newText = document.getElementById('editText').value.trim();
        
                if (newText) {
                    const requirements = await getAllRequirements();
                    const requirement = requirements.find(req => req.id === id);
        
                    if (requirement) {
                        requirement.text = newText;
                        await addOrUpdateRequirement(requirement);
                        loadRequirements();
                    }
        
                    document.getElementById('editModal').classList.add('hidden');
                }
            });
        
            // Cancel edit
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                document.getElementById('editModal').classList.add('hidden');
            });
        
            // Delete requirement
            document.addEventListener('click', async (e) => {
                if (e.target.closest('.delete-btn')) {
                    const id = e.target.closest('.delete-btn').dataset.id;
                    if (confirm('Tem certeza que deseja excluir este requisito?')) {
                        await deleteRequirement(id);
                        loadRequirements();
                    }
                }
            });
        
            // Copy summary
            document.getElementById('copyBtn').addEventListener('click', () => {
                const summary = document.getElementById('summaryText');
                summary.select();
                document.execCommand('copy');
                alert('Requisitos copiados para a √°rea de transfer√™ncia!');
            });
        
            // Export CSV
            document.getElementById('exportBtn').addEventListener('click', async () => {
                const requirements = await getAllRequirements();
                const csvContent = requirements.map(req =>
                    `"${req.id}","${req.text.replace(/"/g, '""')}","${req.createdAt}"`
                ).join('\n');
        
                const blob = new Blob(['id,text,createdAt\n' + csvContent], {
                    type: 'text/csv'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'requisitos.csv';
                a.click();
                URL.revokeObjectURL(url);
            });
        
            // Import CSV
            document.getElementById('importFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const text = await file.text();
                    const lines = text.split('\n').slice(1); // Skip header
        
                    for (const line of lines) {
                        if (line.trim()) {
                            const [id, text, createdAt] = line.split(',').map(field =>
                                field.trim().replace(/^"|"$/g, '')
                            );
        
                            if (id && text) {
                                await addOrUpdateRequirement({
                                    id: id,
                                    text: text,
                                    createdAt: createdAt || new Date().toISOString()
                                });
                            }
                        }
                    }
        
                    loadRequirements();
                    e.target.value = '';
                }
            });
        
            // Clear all requirements
            document.getElementById('clearBtn').addEventListener('click', async () => {
                if (confirm('Tem certeza que deseja limpar todos os requisitos? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    await clearAllRequirements();
                    loadRequirements();
                }
            });
        }
        async function initializeDefaultRequirements() {
            const requirements = await getAllRequirements();
            if (requirements.length === 0) {
                const defaultRequirements = [{
                        "id": "e1fededd-b3da-4fca-9eae-977044fb96db",
                        "text": "Cada registro deve possuir um UUID √∫nico para identifica√ß√£o, garantindo que n√£o haja duplicidade e permitindo atualiza√ß√£o em vez de duplica√ß√£o.",
                        "createdAt": "2025-09-05T16:44:07.252Z"
                    },
                    {
                        "id": "94d6418e-229e-4c13-8508-cde782aa13a2",
                        "text": "O sistema deve armazenar todos os registros localmente usando IndexedDB, garantindo que os dados permane√ßam dispon√≠veis mesmo ap√≥s fechar o navegador ou reiniciar o dispositivo.",
                        "createdAt": "2025-09-06T16:44:03.724Z"
                    },
                    {
                        "id": "5656ef03-f8cd-47ca-b63a-b3d1f2295cb7",
                        "text": "Cada registro deve permitir opera√ß√µes de criar, ler, atualizar e deletar, garantindo total gerenciamento dos dados pelo usu√°rio.",
                        "createdAt": "2025-09-07T16:44:09.764Z"
                    },
                    {
                        "id": "6f35408d-5c4f-4fdb-8b9d-ad75ab2058e6",
                        "text": "Importar CSV: O sistema deve permitir importar registros em formato CSV, atualizando os existentes pelo UUID e adicionando apenas os novos.",
                        "createdAt": "2025-09-08T16:44:03.724Z"
                    },
                    {
                        "id": "2c0c33ff-7bea-4a1b-9ead-22d41b7d9e13",
                        "text": "Exportar CSV: O sistema deve permitir exportar todos os registros em formato CSV.",
                        "createdAt": "2025-09-09T16:44:09.764Z"
                    },
                    {
                        "id": "5d46ec28-9bfc-41c3-8408-5087bfcc632d",
                        "text": "O sistema deve possuir um favicon em formato embutido, sem necessidade de arquivo local na pasta do projeto.",
                        "createdAt": "2025-09-10T16:44:07.252Z"
                    },
                    {
                        "id": "5d123c28-945c-41c3-8408-5087bfcc4574",
                        "text": "caso algum formulario tenha cpf ou telefone colocar uma mascara .",
                        "createdAt": "2025-09-11T16:44:07.252Z"
                    }
                ];
        
                for (const req of defaultRequirements) {
                    await addOrUpdateRequirement(req);
                }
            }
        }

    </script>
</body>
</html>
